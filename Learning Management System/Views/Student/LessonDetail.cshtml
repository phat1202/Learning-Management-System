@model List<Learning_Management_System.Models.Lesson>
@inject LmsDbContext db;
@{
    int? lessonId = 1;
    int? number = 0;
    int? selected = 0;
}
<body>
    <script>
        function getLessonId(itemLessonId) {
            $.ajax({
                url: '/Student/GetLessonId',
                type: 'POST',
                data: {
                    itemLessonId: itemLessonId,
                },
                success: function (result) {
                    if (result.success) {
                        var lessonContentUrl = result.contentUrl;
                        updateVideo(lessonContentUrl);
                    } else {
                        console.error('Error getting Lesson ID: ' + result.errorMessage);
                    }
                },
                error: function (error) {
                    console.error('Error getting Lesson ID: ' + error.responseText);
                }
            });
        }

        function updateVideo(contentUrl) {
            var videoIframe = document.getElementById('videoIframe');
            if (videoIframe) {
                videoIframe.src = contentUrl;
            }
        }

        //Comment//
        document.addEventListener("DOMContentLoaded", function () {
            var replyLink = document.querySelector(".reply-link");
            var replyForm = document.querySelector(".reply-form");

            replyLink.addEventListener("click", function (event) {
                event.preventDefault();
                replyForm.style.display = "block";
            });
        });
        $(document).ready(function () {
            // Handle the submit button click
            $("#submitComment").click(function () {
                // Get the comment text
                var commentText = $("#newComment").val();

                // Make the Ajax request
                $.ajax({
                    type: "POST",
                    url: '/CourseUser/AddComment', // Replace with the actual API endpoint URL
                    data: JSON.stringify({ comment: commentText }),
                    success: function (response) {
                        // Handle success, e.g., update the UI or display a success message
                        console.log("Comment added successfully:", response);

                        // You may want to update the UI to display the new comment immediately
                        // For simplicity, let's assume you have a function displayComment(comment) to update the UI
                        // displayComment(response);
                    },
                    error: function (error) {
                        // Handle errors, e.g., display an error message
                        console.error("Error adding comment:", error);
                    }
                });
            });
        });
    </script>
    @if (Model != null)
    {
        var lesson = db.Lessons.FirstOrDefault(l => l.LessonId == lessonId);
        <div class="container-fluid py-5">
            <div class="container py-5">
                <div class="row">


                    <div class="col-lg-4 mt-5 mt-lg-0">
                        <div class="mb-5">
                            <h3 class="text-uppercase mb-4" style="letter-spacing: 5px;">@Model.First().chapter.ChapterTitle</h3>
                            <ul class="list-group list-group-flush">
                                <li class ="list-group-item d-flex justify-content-between align-items-center px-0">
                                    <a asp-action="StudentCourse" asp-controller="Student" asp-route-courseId="@Model.First().chapter.course.CourseId">Move to another chapter</a>
                                </li>
                                @foreach (var item in Model)
                                {
                                    number++;

                                    <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                        <a href="javascript:void(0);" onclick="getLessonId(@item.LessonId)" class="text-decoration-none h6 m-0">@number. @item.LessonName</a>

                                    </li>
                                    lessonId = item.LessonId;


                                }
                                <li class="list-group-item d-flex justify-content-between align-items-center px-0"></li>

                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <h5>@lesson.LessonName</h5>
                        <div class="embed-responsive embed-responsive-16by9">
                            <iframe id="videoIframe" class="embed-responsive-item" src="@lesson.ContentUrl" allowfullscreen>
                            </iframe>

                        </div>
                        <hr />
                        <!-- Comment Table -->

                        <section class="gradient-custom">
                            <div class="container-fluid my-5 py-5">
                                <div class="row d-flex justify-content-center">
                                    <div class="col-md-12 col-lg-10 col-xl-8">
                                        <div class="card">
                                            <div class="card-body p-4">
                                                <h4 class="text-center mb-4 pb-2">Nested comments section</h4>
                                                <div class="row">
                                                    <div class="col">
                                                        <div class="d-flex flex-start" >
                                                            <img class="rounded-circle shadow-1-strong me-3"
                                                                 src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(10).webp" alt="avatar" width="50"
                                                                 height="50" />
                                                            <div class="flex-grow-1 flex-shrink-1">
                                                                <div>
                                                                    <div class="d-flex justify-content-between align-items-center">
                                                                        <p class="mb-1">
                                                                            Maria Smantha <span class="small">- 2 hours ago</span>
                                                                        </p>
                                                                        <a href="#!" class="reply-link"><i class="fas fa-reply fa-xs"></i><span class="small"> reply</span></a>
                                                                    </div>
                                                                    <p class="small mb-0">
                                                                        It is a long established fact that a reader will be distracted by
                                                                        the readable content of a page.
                                                                    </p>
                                                                </div>
                                                                <div class="d-flex flex-start mt-4">
                                                                    <a class="me-3" href="#">
                                                                        <img class="rounded-circle shadow-1-strong"
                                                                             src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(11).webp" alt="avatar"
                                                                             width="65" height="65" />
                                                                    </a>
                                                                    <div class="flex-grow-1 flex-shrink-1">
                                                                        <div>
                                                                            <div class="d-flex justify-content-between align-items-center">
                                                                                <p class="mb-1">
                                                                                    Simona Disa <span class="small">- 3 hours ago</span>
                                                                                </p>
                                                                            </div>
                                                                            <p class="small mb-0">
                                                                                letters, as opposed to using 'Content here, content here',
                                                                                making it look like readable English.
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="d-flex flex-start mt-4">
                                                                    <a class="me-3" href="#">
                                                                        <img class="rounded-circle shadow-1-strong"
                                                                             src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(32).webp" alt="avatar"
                                                                             width="65" height="65" />
                                                                    </a>
                                                                    <div class="flex-grow-1 flex-shrink-1">
                                                                        <div>
                                                                            <div class="d-flex justify-content-between align-items-center">
                                                                                <p class="mb-1">
                                                                                    John Smith <span class="small">- 4 hours ago</span>
                                                                                </p>
                                                                            </div>
                                                                            <p class="small mb-0">
                                                                                the majority have suffered alteration in some form, by
                                                                                injected humour, or randomised words.
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- Input for reply comment -->
                                                                <form class="mt-3 reply-form" style="display: none;">
                                                                    <div class="input-group mb-3">
                                                                        <textarea type="text" class="form-control" id="newComment" placeholder="Reply this comment"></textarea>
                                                                    </div>
                                                                    <a href="#" class="btn btn-sm btn-primary">Submit</a>
                                                                </form>
                                                            </div>
                                                        </div>
                                                        <!-- Input for new comment -->
                                                        <form id="commentForm" class="mt-3">
                                                            <div class="mb-3">
@*                                                                 <label for="newComment" class="form-label">Add a new comment</label> *@
                                                                <textarea id="newComment" placeholder="Your Comment" class="form-control" id="newComment" rows="3"></textarea>
                                                            </div>
                                                            <button id="submitComment" type="submit" class="btn btn-primary">Submit</button>
                                                        </form>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <!-- Comment Table -->
                    </div>

                </div>
            </div>
        </div>
    }
    else
    {
        <span class="text-danger">Something's gone wrong :(</span>
    }

</body>